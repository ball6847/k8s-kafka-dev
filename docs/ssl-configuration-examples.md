# Bitnami Kafka Helm Chart - SSL/TLS Configuration Examples
# Different approaches to enabling SSL encryption

## Example 1: SASL + SSL (Authentication + Encryption)
# Most common production setup

listeners:
  client:
    containerPort: 9093
    protocol: SASL_SSL      # Both SASL auth + SSL encryption
    name: CLIENT
  controller:
    name: CONTROLLER
    containerPort: 9094
    protocol: SASL_SSL      # Controller with SSL
  interbroker:
    containerPort: 9095
    protocol: SASL_SSL      # Inter-broker with SSL
    name: INTERNAL

# SASL Authentication (same as before)
sasl:
  client:
    users:
      - "kafka-user"
      - "admin-user"
    passwords:
      - "kafka-password"
      - "admin-password"
  mechanisms:
    - SCRAM-SHA-256
  enabledMechanisms: SCRAM-SHA-256

# TLS/SSL Configuration
tls:
  type: JKS                 # Java KeyStore format
  autoGenerated:
    enabled: true           # Auto-generate certificates
    engine: helm            # Use Helm to generate certs
  # OR use existing certificates:
  # existingSecret: "kafka-tls-certs"
  # keystorePassword: "keystore-password"
  # truststorePassword: "truststore-password"

---

## Example 2: SSL Only (Certificate-based Authentication)
# No SASL, authentication via client certificates

listeners:
  client:
    containerPort: 9093
    protocol: SSL           # SSL only (cert-based auth)
    name: CLIENT
    sslClientAuth: required # Require client certificates

# TLS/SSL Configuration
tls:
  type: PEM                 # PEM format certificates
  autoGenerated:
    enabled: true
    engine: cert-manager    # Use cert-manager (if available)
  # Client certificate authentication
  sslClientAuth: required

---

## Example 3: Auto-Generated Certificates (Simplest)
# Let Bitnami generate everything automatically

listeners:
  client:
    containerPort: 9093
    protocol: SASL_SSL
    name: CLIENT

sasl:
  client:
    users: ["kafka-user"]
    passwords: ["kafka-password"]
  mechanisms: [SCRAM-SHA-256]

# Auto-generate TLS certificates
tls:
  type: JKS
  autoGenerated:
    enabled: true           # âœ… Auto-generate certificates
    engine: helm            # Use Helm's built-in generation
  password: "changeit"      # Keystore/truststore password

---

## Example 4: External Certificates (Production)
# Use your own certificates (recommended for production)

listeners:
  client:
    containerPort: 9093
    protocol: SASL_SSL
    name: CLIENT

sasl:
  client:
    users: ["kafka-user"]
    passwords: ["kafka-password"]
  mechanisms: [SCRAM-SHA-256]

# Use existing TLS certificates
tls:
  type: JKS
  existingSecret: "kafka-tls-secret"  # Kubernetes secret with certs
  keystorePassword: "keystore-pass"
  truststorePassword: "truststore-pass"
  # Secret should contain:
  # - kafka.keystore.jks
  # - kafka.truststore.jks

---

## Example 5: cert-manager Integration (Advanced)
# Use cert-manager for automatic certificate management

# Prerequisites: cert-manager must be installed
# kubectl apply -f https://github.com/cert-manager/cert-manager/releases/download/v1.13.0/cert-manager.yaml

listeners:
  client:
    containerPort: 9093
    protocol: SASL_SSL
    name: CLIENT

sasl:
  client:
    users: ["kafka-user"]
    passwords: ["kafka-password"]
  mechanisms: [SCRAM-SHA-256]

tls:
  type: PEM
  autoGenerated:
    enabled: true
    engine: cert-manager    # Use cert-manager
    customAltNames:         # Additional names for certificate
      - "kafka.example.com"
      - "kafka-cluster.local"
  # cert-manager will create and manage certificates automatically

---

## Client Configuration for SSL

# For SASL_SSL connections, clients need:
security.protocol=SASL_SSL
sasl.mechanism=SCRAM-SHA-256
sasl.jaas.config=org.apache.kafka.common.security.scram.ScramLoginModule required \
  username="kafka-user" \
  password="kafka-password";

# SSL settings (if using custom certificates)
ssl.truststore.location=/path/to/kafka.client.truststore.jks
ssl.truststore.password=truststore-password

# If client certificate authentication is required:
ssl.keystore.location=/path/to/kafka.client.keystore.jks
ssl.keystore.password=keystore-password
ssl.key.password=key-password

---

## Port Configuration with SSL

# Default ports for different protocols:
# 9092 - PLAINTEXT
# 9093 - SSL or SASL_SSL
# 9094 - SASL_PLAINTEXT

# Example service configuration:
service:
  type: ClusterIP
  ports:
    client: 9093          # SSL port instead of 9092
